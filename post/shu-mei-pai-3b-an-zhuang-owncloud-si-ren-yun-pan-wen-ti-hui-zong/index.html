<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>æ ‘è“æ´¾ 3B å®‰è£… owncloud ç§äººäº‘ç›˜é—®é¢˜æ±‡æ€» | KAI </title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kaiii0328.github.io/favicon.ico?v=1584535696927">
<link rel="stylesheet" href="https://kaiii0328.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="ç–«æƒ…åœ¨å®¶é—²ç€æ— èŠæƒ³åšä¸€äº›å°é¡¹ç›®ï¼Œåˆšå¥½æ‰‹ä¸Šæœ‰ä¸€å—æ ‘è“æ´¾ 3B çš„æ¿å­ï¼Œä¸Šç½‘æœäº†æœä¸€äº›å°é¡¹ç›®å°±å¼€å§‹åšäº†ï¼Œä»Šå¤©è¿™ç¯‡ä»‹ç»å¦‚ä½•åœ¨æ ‘è“æ´¾3ä¸Šæ­å»ºä¸€ä¸ªä¸ªäººç§æœ‰äº‘ç›˜ï¼Œå¯ä»¥å­˜å‚¨è‡ªå·±çš„ä¸€äº›æ–‡ä»¶ï¼Œä¸»è¦å‚è€ƒäº†è¿™ç¯‡åšå®¢ https://www.lxx1.com/25..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kaiii0328.github.io">
        <img src="https://kaiii0328.github.io/images/avatar.png?v=1584535696927" class="site-logo">
        <h1 class="site-title">KAI </h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/kaiii0328" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
          <a class="social-link" href="https://www.zhihu.com/people/jin-wang-kai" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
      
    </div>
    <div class="site-description">
      ä½ å¥½å•Š
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://kaiii0328.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">æ ‘è“æ´¾ 3B å®‰è£… owncloud ç§äººäº‘ç›˜é—®é¢˜æ±‡æ€»</h2>
            <div class="post-date">2020-03-18</div>
            
            <div class="post-content" v-pre>
              <p>ç–«æƒ…åœ¨å®¶é—²ç€æ— èŠæƒ³åšä¸€äº›å°é¡¹ç›®ï¼Œåˆšå¥½æ‰‹ä¸Šæœ‰ä¸€å—æ ‘è“æ´¾ 3B çš„æ¿å­ï¼Œä¸Šç½‘æœäº†æœä¸€äº›å°é¡¹ç›®å°±å¼€å§‹åšäº†ï¼Œä»Šå¤©è¿™ç¯‡ä»‹ç»å¦‚ä½•åœ¨æ ‘è“æ´¾3ä¸Šæ­å»ºä¸€ä¸ªä¸ªäººç§æœ‰äº‘ç›˜ï¼Œå¯ä»¥å­˜å‚¨è‡ªå·±çš„ä¸€äº›æ–‡ä»¶ï¼Œä¸»è¦å‚è€ƒäº†è¿™ç¯‡åšå®¢ https://www.lxx1.com/2515/comment-page-1#comment-59883 å¦‚æœè¿˜æ²¡æœ‰å®‰è£…æ­å»ºè¿‡ LNMP ç³»ç»Ÿçš„å¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢ http://www.lxx1.com/3696</p>
<p>åŸºæœ¬ä¸Šå®‰è£…çš„æ­¥éª¤ä¸å¤ªéš¾ï¼Œå‚è€ƒè¿™ä¸¤ç¯‡å°±å¯ä»¥äº†ï¼Œä½†æˆ‘ä½œä¸ºä¸€ä¸ªæ–°æ‰‹é‡åˆ°äº†å¾ˆå¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« å…¶å®æ›´æƒ³è¦åšçš„æ˜¯æŠŠè‡ªå·±çš„é”™è¯¯æ•´ç†ä¸€ä¸‹ï¼Œå¸Œæœ›åé¢åšè¿™ä¸ªå°é¡¹ç›®çš„äººå¯ä»¥å°‘èµ°ç‚¹å¼¯è·¯ï¼Œæœ¬äººåœ¨ç½‘ä¸ŠæŸ¥é‡åˆ°çš„å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜çš„è§£å†³æ–¹æ³•æµªè´¹äº†ä¸å°‘æ—¶é—´ï¼Œå¯¹è¿™äº›æµé€çš„æ—¶é—´æ·±æ„Ÿç—›å¿ƒã€‚</p>
<ol>
<li>
<p><code>PHP intl æ¨¡å—æœªå®‰è£…</code></p>
<p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŒå­¦æ˜¯å› ä¸ºæ²¡æœ‰å®‰è£… php intl æ‹“å±•å¯¼è‡´çš„ï¼ˆå¦‚æœé‡‡ç”¨æˆ‘æ¨èçš„ç¬¬äºŒç¯‡åšå®¢é“¾æ¥å®‰è£… LNMP ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œè§£å†³æ–¹æ³•å¾ˆç®€å•å°±æ˜¯å®‰è£…è¿™ä¸ªæ¨¡å—</p>
<pre><code>sudo apt-get install php-intl
</code></pre>
</li>
<li>
<p>åˆ›å»º owncloud è´¦å·çš„æ—¶å€™ç½‘é¡µæç¤º <code>Canâ€™t create or write into the apps-external directory /var/www/html/owncloud/apps-external</code></p>
<p>å‡ºç°è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯æƒé™é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•</p>
<pre><code>$sudo mkdir /var/www/html/owncloud/apps-external #(å…ˆæ‰‹åŠ¨åˆ›å»ºè¿™ä¸ªæ–‡ä»¶å¤¹)
$sudo chmod 755 /var/www/html/owncloud/apps-external #(æŠŠè¿™ä¸ªæ–‡ä»¶å¤¹çš„æƒé™æ”¹ä¸º 755)
$ sudo chown -hR www-data owncloud #(ç»§ç»­æ›´æ”¹æƒé™)
$ sudo chgrp -hR www-data owncloud
</code></pre>
</li>
<li>
<p>ç‚¹å‡»å®‰è£…å®Œæˆçš„æ—¶å€™å‡ºç° <code>SQLSTATE[HY000] [1045] Access denied for user â€˜kaiiiâ€™@â€™localhostâ€™ (using password: YES)</code></p>
</li>
<li>
<p>æˆ–è€…ç‚¹å‡»å®‰è£…å®Œæˆçš„æ—¶å€™ mysql å¯èƒ½è¿˜ä¼šå‡ºç°é—®é¢˜ï¼Œé‡å¯ä¸€ä¸‹å°±è¡Œ</p>
</li>
<li>
<p>æˆ–è€…ç‚¹å‡»å®‰è£…å®Œæˆçš„æ—¶å€™ç½‘é¡µåŠ è½½å¾ˆä¹…ä¹‹åå‡ºç° <code>504 Gateway Timeout</code></p>
<p>æˆ‘ä»¬æ˜¯ä½¿ç”¨ Nginx+FastCGIï¼ˆphp-fpmï¼‰è¿›è¡Œç½‘é¡µåŠ è½½è§£æçš„ï¼Œ504 é”™è¯¯æ„å‘³ç€å“åº”æ—¶é—´è¿‡é•¿ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ Nginx å’Œ php çš„ä¸€äº›æ–‡ä»¶å°±è¡Œ å…ˆæ‰“å¼€ /etc/php/7.3/fpm/php.ini ä¿®æ”¹</p>
<pre><code>max_execution_time= 300
</code></pre>
<p>ç„¶åæ‰“å¼€ /etc/php/7.3/fpm/pool.d/www.conf æ–‡ä»¶ ä¿®æ”¹</p>
<pre><code>request_terminate_timeout=300
</code></pre>
<p>æ¥ç€æ‰“å¼€ /etc/nginx/sites-available/defaultæ–‡ä»¶  åŠ å…¥ <code>fastcgi_read_timeout=300</code></p>
<pre><code>location ~ \.php$ {
                include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
                fastcgi_pass unix:/run/php/php7.3-fpm.sock;
        #       # With php-cgi (or other tcp sockets):          
        #       fastcgi_pass 127.0.0.1:9000;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                include fastcgi_params;
                fastcgi_read_timeout 300;
}
</code></pre>
<p>æœ€åé‡å¯ Nginx</p>
<pre><code>sudo nginx -s reload
</code></pre>
</li>
<li>
<p>Nginx é‡å¯æ—¶æŠ¥é”™  <code>[error] open() â€œ/run/nginx/nginx.pidâ€ failed</code></p>
<p>å¯èƒ½åŸå› æ˜¯æ¯æ¬¡å¯åŠ¨ï¼Œç³»ç»Ÿéƒ½ä¼šè‡ªåŠ¨åˆ é™¤æ–‡ä»¶ï¼Œæ‰€ä»¥è§£å†³æ–¹æ³•æ˜¯ä¿®æ”¹å­˜å‚¨ä½ç½®æˆ–è€…é‡æ–°å¼€æœºã€‚è¯¥æ–‡ä»¶é‡Œé¢åªå­˜å‚¨äº†nginxä¸»è¿›ç¨‹çš„åºåˆ—å·ï¼ŒæŠŠæ•°å­—è®°ä½æ–°å»ºä¸€ä¸ªå°±è¡Œï¼Œç„¶åå» nginx.conf ä¿®æ”¹ pid çš„è·¯å¾„</p>
</li>
<li>
<p>å¯åŠ¨ nginx æ—¶ <code>nginx: [alert] could not open error log file: open() &quot;/var/log/nginx/error.log&quot; failed (13: Permission denied)</code><br>
<code>2020/03/18 20:35:10 [warn] 8089#8089: the &quot;user&quot; directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:1</code><br>
<code>2020/03/18 20:35:10 [emerg] 8089#8089: open() &quot;/var/log/nginx/access.log&quot; failed (13: Permission denied)</code></p>
<p>ä¸€ç§åˆ†ææ˜¯ç«¯å£å·è¢«å ç”¨äº†ï¼Œæ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹å³å¯ï¼Œå…ˆä½¿ç”¨è¯­å¥æŸ¥çœ‹ç«¯å£çŠ¶æ€</p>
<pre><code>netstat -nltp| grep 80
</code></pre>
<p>ç„¶åå¯ä»¥çœ‹ 80 ç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨æˆ–è€…ç›´æ¥çœ‹æœ‰æ²¡æœ‰è¿›è¡Œä¸­çš„ nginx è¿›ç¨‹</p>
<pre><code>ps -ef |grep 80   æˆ–è€…  ps -ef |grep nginx
</code></pre>
<p>æ‰¾åˆ°å ç”¨ç«¯å£çš„è¿›ç¨‹æ€æ­»å°±è¡Œ</p>
<pre><code>sudo kill -9 åºåˆ—å·
</code></pre>
<p>ä¹‹åé‡å¯ nginx</p>
<p>å¦ä¸€ç§åˆ†ææ˜¯å› ä¸º 80 ç«¯å£å…ˆäº ipv4 ç»‘å®šï¼Œä¹‹ååˆå’Œ ipv6 ç»‘å®šï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€ /etc/nginx/sites-available/defaultæ–‡ä»¶ï¼Œå°† default æ”¹æˆ ipv6 å³å¯ã€‚ä¸€èˆ¬æ¥è¯´ç¬¬äºŒç§æ–¹æ³•æ›´æ²»æœ¬ä¸€ç‚¹</p>
<pre><code>listen [::]:80 ipv6only=on  default_server;
</code></pre>
</li>
</ol>
<p>ä»¥ä¸Šå°±æ˜¯æœ¬äººé‡åˆ°è¿‡çš„æ‰€æœ‰é—®é¢˜æ±‡æ€»ï¼Œå¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ©ğŸ˜‰</p>
<p>â€‹</p>
<p>â€‹</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://kaiii0328.github.io/post/hello-gridea/">
                  <h3 class="post-title">
                    Hello Gridea
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
