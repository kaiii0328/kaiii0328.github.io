<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>树莓派 3B 安装 owncloud 私人云盘问题汇总 | KAI </title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://kaiii0328.github.io/favicon.ico?v=1584535696927">
<link rel="stylesheet" href="https://kaiii0328.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="疫情在家闲着无聊想做一些小项目，刚好手上有一块树莓派 3B 的板子，上网搜了搜一些小项目就开始做了，今天这篇介绍如何在树莓派3上搭建一个个人私有云盘，可以存储自己的一些文件，主要参考了这篇博客 https://www.lxx1.com/25..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://kaiii0328.github.io">
        <img src="https://kaiii0328.github.io/images/avatar.png?v=1584535696927" class="site-logo">
        <h1 class="site-title">KAI </h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/kaiii0328" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
          <a class="social-link" href="https://www.zhihu.com/people/jin-wang-kai" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
      
    </div>
    <div class="site-description">
      你好啊
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://kaiii0328.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">树莓派 3B 安装 owncloud 私人云盘问题汇总</h2>
            <div class="post-date">2020-03-18</div>
            
            <div class="post-content" v-pre>
              <p>疫情在家闲着无聊想做一些小项目，刚好手上有一块树莓派 3B 的板子，上网搜了搜一些小项目就开始做了，今天这篇介绍如何在树莓派3上搭建一个个人私有云盘，可以存储自己的一些文件，主要参考了这篇博客 https://www.lxx1.com/2515/comment-page-1#comment-59883 如果还没有安装搭建过 LNMP 系统的可以参考这篇博客 http://www.lxx1.com/3696</p>
<p>基本上安装的步骤不太难，参考这两篇就可以了，但我作为一个新手遇到了很多奇奇怪怪的问题，我写这篇文章其实更想要做的是把自己的错误整理一下，希望后面做这个小项目的人可以少走点弯路，本人在网上查遇到的奇奇怪怪的问题的解决方法浪费了不少时间，对这些流逝的时间深感痛心。</p>
<ol>
<li>
<p><code>PHP intl 模块未安装</code></p>
<p>出现这个问题的同学是因为没有安装 php intl 拓展导致的（如果采用我推荐的第二篇博客链接安装 LNMP 会遇到这个问题），解决方法很简单就是安装这个模块</p>
<pre><code>sudo apt-get install php-intl
</code></pre>
</li>
<li>
<p>创建 owncloud 账号的时候网页提示 <code>Can’t create or write into the apps-external directory /var/www/html/owncloud/apps-external</code></p>
<p>出现这个问题主要是权限问题，解决方法也很简单</p>
<pre><code>$sudo mkdir /var/www/html/owncloud/apps-external #(先手动创建这个文件夹)
$sudo chmod 755 /var/www/html/owncloud/apps-external #(把这个文件夹的权限改为 755)
$ sudo chown -hR www-data owncloud #(继续更改权限)
$ sudo chgrp -hR www-data owncloud
</code></pre>
</li>
<li>
<p>点击安装完成的时候出现 <code>SQLSTATE[HY000] [1045] Access denied for user ‘kaiii’@’localhost’ (using password: YES)</code></p>
</li>
<li>
<p>或者点击安装完成的时候 mysql 可能还会出现问题，重启一下就行</p>
</li>
<li>
<p>或者点击安装完成的时候网页加载很久之后出现 <code>504 Gateway Timeout</code></p>
<p>我们是使用 Nginx+FastCGI（php-fpm）进行网页加载解析的，504 错误意味着响应时间过长，我们只需要修改一下 Nginx 和 php 的一些文件就行 先打开 /etc/php/7.3/fpm/php.ini 修改</p>
<pre><code>max_execution_time= 300
</code></pre>
<p>然后打开 /etc/php/7.3/fpm/pool.d/www.conf 文件 修改</p>
<pre><code>request_terminate_timeout=300
</code></pre>
<p>接着打开 /etc/nginx/sites-available/default文件  加入 <code>fastcgi_read_timeout=300</code></p>
<pre><code>location ~ \.php$ {
                include snippets/fastcgi-php.conf;
        #
        #       # With php-fpm (or other unix sockets):
                fastcgi_pass unix:/run/php/php7.3-fpm.sock;
        #       # With php-cgi (or other tcp sockets):          
        #       fastcgi_pass 127.0.0.1:9000;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                include fastcgi_params;
                fastcgi_read_timeout 300;
}
</code></pre>
<p>最后重启 Nginx</p>
<pre><code>sudo nginx -s reload
</code></pre>
</li>
<li>
<p>Nginx 重启时报错  <code>[error] open() “/run/nginx/nginx.pid” failed</code></p>
<p>可能原因是每次启动，系统都会自动删除文件，所以解决方法是修改存储位置或者重新开机。该文件里面只存储了nginx主进程的序列号，把数字记住新建一个就行，然后去 nginx.conf 修改 pid 的路径</p>
</li>
<li>
<p>启动 nginx 时 <code>nginx: [alert] could not open error log file: open() &quot;/var/log/nginx/error.log&quot; failed (13: Permission denied)</code><br>
<code>2020/03/18 20:35:10 [warn] 8089#8089: the &quot;user&quot; directive makes sense only if the master process runs with super-user privileges, ignored in /etc/nginx/nginx.conf:1</code><br>
<code>2020/03/18 20:35:10 [emerg] 8089#8089: open() &quot;/var/log/nginx/access.log&quot; failed (13: Permission denied)</code></p>
<p>一种分析是端口号被占用了，杀死占用端口的进程即可，先使用语句查看端口状态</p>
<pre><code>netstat -nltp| grep 80
</code></pre>
<p>然后可以看 80 端口有没有被占用或者直接看有没有进行中的 nginx 进程</p>
<pre><code>ps -ef |grep 80   或者  ps -ef |grep nginx
</code></pre>
<p>找到占用端口的进程杀死就行</p>
<pre><code>sudo kill -9 序列号
</code></pre>
<p>之后重启 nginx</p>
<p>另一种分析是因为 80 端口先于 ipv4 绑定，之后又和 ipv6 绑定，我们需要打开 /etc/nginx/sites-available/default文件，将 default 改成 ipv6 即可。一般来说第二种方法更治本一点</p>
<pre><code>listen [::]:80 ipv6only=on  default_server;
</code></pre>
</li>
</ol>
<p>以上就是本人遇到过的所有问题汇总，希望对你有帮助😉</p>
<p>​</p>
<p>​</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://kaiii0328.github.io/post/hello-gridea/">
                  <h3 class="post-title">
                    Hello Gridea
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
